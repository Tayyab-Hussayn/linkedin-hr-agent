<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="PostFlow">
<meta name="theme-color" content="#ffffff">
<title>PostFlow — LinkedIn Manager</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">

<style>
  /* ── Reset & Base ─────────────────────────────────────────── */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  :root {
    --white: #ffffff;
    --off-white: #f5f5f7;
    --surface: #ffffff;
    --surface-2: #f5f5f7;
    --surface-3: #e8e8ed;
    --border: rgba(0,0,0,0.08);
    --border-strong: rgba(0,0,0,0.14);
    --text-primary: #1d1d1f;
    --text-secondary: #6e6e73;
    --text-tertiary: #aeaeb2;
    --blue: #0071e3;
    --blue-light: #e8f1fb;
    --green: #30d158;
    --green-light: #e6faf0;
    --red: #ff3b30;
    --red-light: #fff0ef;
    --orange: #ff9f0a;
    --orange-light: #fff6e6;
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.06), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.08), 0 1px 4px rgba(0,0,0,0.04);
    --shadow-lg: 0 8px 32px rgba(0,0,0,0.10), 0 2px 8px rgba(0,0,0,0.06);
    --shadow-xl: 0 20px 60px rgba(0,0,0,0.12), 0 4px 16px rgba(0,0,0,0.08);
    --radius-sm: 10px;
    --radius-md: 16px;
    --radius-lg: 20px;
    --radius-xl: 28px;
    --radius-full: 9999px;
    --font: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-display: 'DM Serif Display', Georgia, serif;
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
    --n8n-url: 'http://localhost:5678';
  }

  html { height: 100%; background: var(--off-white); }

  body {
    font-family: var(--font);
    background: var(--off-white);
    color: var(--text-primary);
    min-height: 100%;
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* ── App Shell ────────────────────────────────────────────── */
  .app {
    max-width: 430px;
    margin: 0 auto;
    min-height: 100vh;
    background: var(--off-white);
    position: relative;
  }

  /* ── Status Bar Spacer ────────────────────────────────────── */
  .status-bar {
    height: calc(var(--safe-top) + 12px);
    background: var(--white);
  }

  /* ── Header ───────────────────────────────────────────────── */
  .header {
    background: var(--white);
    padding: 0 20px 16px;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
  }

  .header-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 4px;
  }

  .app-logo {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .logo-icon {
    width: 34px;
    height: 34px;
    background: var(--blue);
    border-radius: 9px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,113,227,0.3);
  }

  .logo-icon svg { width: 18px; height: 18px; }

  .app-name {
    font-size: 17px;
    font-weight: 700;
    letter-spacing: -0.3px;
    color: var(--text-primary);
  }

  .header-actions {
    display: flex;
    gap: 8px;
    align-items: center;
  }

  .icon-btn {
    width: 34px;
    height: 34px;
    border: none;
    background: var(--surface-2);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.15s ease;
    color: var(--text-secondary);
  }

  .icon-btn:active { transform: scale(0.92); background: var(--surface-3); }
  .icon-btn svg { width: 16px; height: 16px; }

  /* ── Tabs ─────────────────────────────────────────────────── */
  .tabs {
    display: flex;
    gap: 4px;
    margin-top: 14px;
    background: var(--surface-2);
    border-radius: var(--radius-full);
    padding: 3px;
  }

  .tab {
    flex: 1;
    border: none;
    background: transparent;
    padding: 8px 12px;
    border-radius: var(--radius-full);
    font-family: var(--font);
    font-size: 13px;
    font-weight: 500;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    white-space: nowrap;
  }

  .tab.active {
    background: var(--white);
    color: var(--text-primary);
    font-weight: 600;
    box-shadow: var(--shadow-sm);
  }

  .tab-badge {
    background: var(--blue);
    color: white;
    font-size: 10px;
    font-weight: 700;
    min-width: 16px;
    height: 16px;
    border-radius: var(--radius-full);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    line-height: 1;
  }

  .tab.active .tab-badge { background: var(--blue); }

  /* ── Content Area ─────────────────────────────────────────── */
  .content {
    padding: 16px 16px calc(var(--safe-bottom) + 80px);
  }

  .tab-panel { display: none; }
  .tab-panel.active { display: block; }

  /* ── Stats Strip ──────────────────────────────────────────── */
  .stats-strip {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-bottom: 20px;
  }

  .stat-card {
    background: var(--white);
    border-radius: var(--radius-md);
    padding: 14px 12px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    text-align: center;
    animation: fadeSlideUp 0.4s ease both;
  }

  .stat-card:nth-child(2) { animation-delay: 0.05s; }
  .stat-card:nth-child(3) { animation-delay: 0.10s; }

  .stat-value {
    font-size: 26px;
    font-weight: 700;
    letter-spacing: -1px;
    line-height: 1;
    margin-bottom: 4px;
  }

  .stat-label {
    font-size: 11px;
    color: var(--text-tertiary);
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .stat-pending .stat-value { color: var(--orange); }
  .stat-approved .stat-value { color: var(--green); }
  .stat-published .stat-value { color: var(--blue); }

  /* ── Section Headers ──────────────────────────────────────── */
  .section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
    padding: 0 2px;
  }

  .section-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .section-action {
    font-size: 13px;
    color: var(--blue);
    font-weight: 500;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  /* ── Post Cards ───────────────────────────────────────────── */
  .posts-list { display: flex; flex-direction: column; gap: 12px; }

  .post-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border);
    overflow: hidden;
    animation: fadeSlideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) both;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }

  .post-card:active { transform: scale(0.985); box-shadow: var(--shadow-sm); }

  .post-card:nth-child(1) { animation-delay: 0.05s; }
  .post-card:nth-child(2) { animation-delay: 0.10s; }
  .post-card:nth-child(3) { animation-delay: 0.15s; }
  .post-card:nth-child(4) { animation-delay: 0.20s; }
  .post-card:nth-child(5) { animation-delay: 0.25s; }

  .post-card-header {
    padding: 14px 16px 10px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 10px;
  }

  .post-pillar-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: var(--blue-light);
    color: var(--blue);
    font-size: 11px;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: var(--radius-full);
    letter-spacing: 0.2px;
  }

  .post-status-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-top: 4px;
    flex-shrink: 0;
  }

  .status-pending .post-status-dot { background: var(--orange); box-shadow: 0 0 0 3px var(--orange-light); }
  .status-approved .post-status-dot { background: var(--green); box-shadow: 0 0 0 3px var(--green-light); }
  .status-published .post-status-dot { background: var(--blue); box-shadow: 0 0 0 3px var(--blue-light); }
  .status-rejected .post-status-dot { background: var(--red); box-shadow: 0 0 0 3px var(--red-light); }

  .post-content-preview {
    padding: 0 16px 14px;
  }

  .post-hook {
    font-family: var(--font-display);
    font-size: 16px;
    color: var(--text-primary);
    line-height: 1.35;
    margin-bottom: 8px;
    letter-spacing: -0.2px;
  }

  .post-body-preview {
    font-size: 13.5px;
    color: var(--text-secondary);
    line-height: 1.55;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .post-meta {
    padding: 10px 16px;
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .post-time {
    font-size: 12px;
    color: var(--text-tertiary);
    font-weight: 400;
  }

  .post-words {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  /* ── Action Buttons on Card ───────────────────────────────── */
  .post-actions {
    padding: 10px 16px 14px;
    display: flex;
    gap: 8px;
  }

  .btn {
    flex: 1;
    border: none;
    border-radius: var(--radius-sm);
    padding: 11px 12px;
    font-family: var(--font);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    letter-spacing: -0.1px;
  }

  .btn:active { transform: scale(0.95); }

  .btn-approve {
    background: var(--green);
    color: white;
    box-shadow: 0 2px 8px rgba(48,209,88,0.3);
  }

  .btn-approve:hover { background: #28c950; }

  .btn-reject {
    background: var(--red-light);
    color: var(--red);
  }

  .btn-reject:hover { background: #ffe5e3; }

  .btn-edit {
    background: var(--surface-2);
    color: var(--text-secondary);
    flex: 0.6;
  }

  .btn svg { width: 14px; height: 14px; }

  /* ── Empty State ──────────────────────────────────────────── */
  .empty-state {
    text-align: center;
    padding: 48px 24px;
    animation: fadeSlideUp 0.5s ease both;
  }

  .empty-icon {
    width: 64px;
    height: 64px;
    background: var(--surface-2);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
  }

  .empty-icon svg { width: 28px; height: 28px; color: var(--text-tertiary); }

  .empty-title {
    font-size: 17px;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 6px;
  }

  .empty-subtitle {
    font-size: 14px;
    color: var(--text-secondary);
    line-height: 1.5;
  }

  /* ── Loading Skeleton ─────────────────────────────────────── */
  .skeleton-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    padding: 16px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    margin-bottom: 12px;
    overflow: hidden;
  }

  .skeleton-line {
    height: 12px;
    background: linear-gradient(90deg, var(--surface-2) 25%, var(--surface-3) 50%, var(--surface-2) 75%);
    background-size: 200% 100%;
    border-radius: var(--radius-full);
    animation: shimmer 1.5s infinite;
    margin-bottom: 10px;
  }

  .skeleton-line.short { width: 40%; }
  .skeleton-line.medium { width: 70%; }
  .skeleton-line.tall { height: 16px; margin-bottom: 14px; }

  @keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* ── Bottom Nav ───────────────────────────────────────────── */
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100%;
    max-width: 430px;
    background: rgba(255,255,255,0.85);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border-top: 1px solid var(--border);
    display: flex;
    padding: 8px 16px calc(var(--safe-bottom) + 8px);
    gap: 0;
    z-index: 200;
  }

  .nav-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: var(--radius-sm);
    transition: all 0.15s ease;
    color: var(--text-tertiary);
  }

  .nav-item.active { color: var(--blue); }
  .nav-item:active { transform: scale(0.9); }

  .nav-item svg { width: 22px; height: 22px; }

  .nav-label {
    font-size: 10px;
    font-weight: 500;
    letter-spacing: 0.2px;
  }

  /* ── Sheet Modal ──────────────────────────────────────────── */
  .sheet-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 300;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    backdrop-filter: blur(4px);
  }

  .sheet-overlay.open { opacity: 1; pointer-events: all; }

  .sheet {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%) translateY(100%);
    width: 100%;
    max-width: 430px;
    background: var(--white);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    z-index: 400;
    transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    max-height: 92vh;
    overflow-y: auto;
    padding-bottom: calc(var(--safe-bottom) + 24px);
  }

  .sheet.open { transform: translateX(-50%) translateY(0); }

  .sheet-handle {
    width: 36px;
    height: 4px;
    background: var(--surface-3);
    border-radius: var(--radius-full);
    margin: 12px auto 0;
  }

  .sheet-header {
    padding: 16px 20px 0;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .sheet-title {
    font-size: 17px;
    font-weight: 700;
    letter-spacing: -0.3px;
  }

  .sheet-close {
    width: 28px;
    height: 28px;
    background: var(--surface-2);
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.15s ease;
  }

  .sheet-close:active { transform: scale(0.9); }
  .sheet-close svg { width: 14px; height: 14px; }

  .sheet-body { padding: 16px 20px; }

  .sheet-pillar-tag {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: var(--blue-light);
    color: var(--blue);
    font-size: 12px;
    font-weight: 600;
    padding: 5px 12px;
    border-radius: var(--radius-full);
    margin-bottom: 16px;
  }

  .sheet-post-text {
    font-size: 15px;
    line-height: 1.65;
    color: var(--text-primary);
    white-space: pre-line;
    background: var(--surface-2);
    border-radius: var(--radius-md);
    padding: 16px;
    margin-bottom: 16px;
  }

  .edit-textarea {
    width: 100%;
    min-height: 200px;
    border: 1.5px solid var(--border-strong);
    border-radius: var(--radius-md);
    padding: 14px 16px;
    font-family: var(--font);
    font-size: 15px;
    line-height: 1.65;
    color: var(--text-primary);
    resize: vertical;
    outline: none;
    background: var(--white);
    transition: border-color 0.2s ease;
    margin-bottom: 12px;
  }

  .edit-textarea:focus { border-color: var(--blue); }

  .char-count {
    font-size: 12px;
    color: var(--text-tertiary);
    text-align: right;
    margin-bottom: 16px;
    margin-top: -8px;
  }

  .char-count.warn { color: var(--orange); }
  .char-count.over { color: var(--red); }

  .sheet-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    padding: 0 20px;
  }

  .btn-full {
    width: 100%;
    border: none;
    border-radius: var(--radius-md);
    padding: 15px;
    font-family: var(--font);
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.15s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    letter-spacing: -0.2px;
  }

  .btn-full:active { transform: scale(0.97); }

  .btn-full-approve {
    background: var(--green);
    color: white;
    box-shadow: 0 4px 16px rgba(48,209,88,0.35);
  }

  .btn-full-approve:hover { background: #28c950; }

  .btn-full-save {
    background: var(--blue);
    color: white;
    box-shadow: 0 4px 16px rgba(0,113,227,0.3);
  }

  .btn-full-reject {
    background: var(--red-light);
    color: var(--red);
  }

  .btn-full svg { width: 18px; height: 18px; }

  /* ── Toast ────────────────────────────────────────────────── */
  .toast-container {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: calc(100% - 32px);
    max-width: 398px;
    pointer-events: none;
  }

  .toast {
    background: var(--text-primary);
    color: white;
    padding: 14px 18px;
    border-radius: var(--radius-md);
    font-size: 14px;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 10px;
    box-shadow: var(--shadow-xl);
    animation: toastIn 0.4s cubic-bezier(0.16, 1, 0.3, 1) both;
    pointer-events: all;
  }

  .toast.success { background: #1a1a1a; }
  .toast.error { background: #1a1a1a; }

  .toast-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .toast.success .toast-icon { background: var(--green); }
  .toast.error .toast-icon { background: var(--red); }

  .toast-icon svg { width: 13px; height: 13px; color: white; }

  .toast.removing {
    animation: toastOut 0.3s ease forwards;
  }

  /* ── History Cards ────────────────────────────────────────── */
  .history-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    overflow: hidden;
    margin-bottom: 12px;
    animation: fadeSlideUp 0.4s ease both;
  }

  .history-card-header {
    padding: 14px 16px 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .history-status-badge {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 11px;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: var(--radius-full);
    letter-spacing: 0.2px;
  }

  .badge-published { background: var(--blue-light); color: var(--blue); }
  .badge-rejected { background: var(--red-light); color: var(--red); }
  .badge-approved { background: var(--green-light); color: var(--green); }

  .history-preview {
    padding: 0 16px 14px;
    font-size: 13.5px;
    color: var(--text-secondary);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* ── Settings ─────────────────────────────────────────────── */
  .settings-section {
    margin-bottom: 24px;
    animation: fadeSlideUp 0.4s ease both;
  }

  .settings-group {
    background: var(--white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
    overflow: hidden;
  }

  .settings-row {
    display: flex;
    align-items: center;
    padding: 14px 16px;
    border-bottom: 1px solid var(--border);
    gap: 14px;
  }

  .settings-row:last-child { border-bottom: none; }

  .settings-icon {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }

  .settings-icon svg { width: 16px; height: 16px; color: white; }

  .settings-text { flex: 1; }

  .settings-label {
    font-size: 15px;
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 2px;
  }

  .settings-sublabel {
    font-size: 12px;
    color: var(--text-tertiary);
  }

  .settings-input {
    width: 100%;
    border: 1.5px solid var(--border-strong);
    border-radius: var(--radius-sm);
    padding: 10px 12px;
    font-family: var(--font);
    font-size: 14px;
    color: var(--text-primary);
    outline: none;
    background: var(--white);
    transition: border-color 0.2s ease;
    margin-top: 8px;
  }

  .settings-input:focus { border-color: var(--blue); }

  .settings-value {
    font-size: 14px;
    color: var(--text-tertiary);
  }

  .chevron { color: var(--text-tertiary); }
  .chevron svg { width: 14px; height: 14px; }

  /* ── Loading Spinner ──────────────────────────────────────── */
  .spinner {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255,255,255,0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    display: inline-block;
  }

  /* ── Animations ───────────────────────────────────────────── */
  @keyframes fadeSlideUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes toastIn {
    from { opacity: 0; transform: translateY(-20px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  @keyframes toastOut {
    to { opacity: 0; transform: translateY(-10px) scale(0.95); }
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @keyframes pulse-dot {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.4; }
  }

  .live-dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    background: var(--green);
    border-radius: 50%;
    animation: pulse-dot 2s ease infinite;
  }

  /* ── Scrollbar ────────────────────────────────────────────── */
  ::-webkit-scrollbar { width: 0; }

  /* ── Pull to refresh hint ─────────────────────────────────── */
  .refresh-hint {
    text-align: center;
    padding: 8px;
    font-size: 12px;
    color: var(--text-tertiary);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    margin-bottom: 4px;
  }
</style>
</head>
<body>

<div class="app">
  <div class="status-bar"></div>

  <!-- Header -->
  <header class="header">
    <div class="header-top">
      <div class="app-logo">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"/>
            <rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/>
          </svg>
        </div>
        <span class="app-name">PostFlow</span>
      </div>
      <div class="header-actions">
        <span class="live-dot"></span>
        <button class="icon-btn" onclick="loadAllData()" title="Refresh">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/>
            <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
          </svg>
        </button>
      </div>
    </div>
    <div class="tabs">
      <button class="tab active" onclick="switchTab('queue')" id="tab-queue">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        Queue
        <span class="tab-badge" id="queue-badge">0</span>
      </button>
      <button class="tab" onclick="switchTab('history')" id="tab-history">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        History
      </button>
      <button class="tab" onclick="switchTab('settings')" id="tab-settings">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
        Settings
      </button>
    </div>
  </header>

  <!-- Content -->
  <main class="content">

    <!-- Queue Tab -->
    <div class="tab-panel active" id="panel-queue">
      <div class="stats-strip">
        <div class="stat-card stat-pending">
          <div class="stat-value" id="stat-pending">—</div>
          <div class="stat-label">Pending</div>
        </div>
        <div class="stat-card stat-approved">
          <div class="stat-value" id="stat-approved">—</div>
          <div class="stat-label">Approved</div>
        </div>
        <div class="stat-card stat-published">
          <div class="stat-value" id="stat-published">—</div>
          <div class="stat-label">Published</div>
        </div>
      </div>

      <div class="section-header">
        <span class="section-title">Pending Review</span>
        <button class="section-action" onclick="loadAllData()">Refresh</button>
      </div>

      <div class="posts-list" id="queue-list">
        <!-- Skeleton loaders -->
        <div class="skeleton-card">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line tall"></div>
          <div class="skeleton-line medium"></div>
          <div class="skeleton-line short"></div>
        </div>
        <div class="skeleton-card">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line tall"></div>
          <div class="skeleton-line medium"></div>
        </div>
      </div>
    </div>

    <!-- History Tab -->
    <div class="tab-panel" id="panel-history">
      <div class="section-header">
        <span class="section-title">Post History</span>
      </div>
      <div id="history-list">
        <div class="skeleton-card">
          <div class="skeleton-line short"></div>
          <div class="skeleton-line medium"></div>
          <div class="skeleton-line short"></div>
        </div>
      </div>
    </div>

    <!-- Settings Tab -->
    <div class="tab-panel" id="panel-settings">
      <div class="settings-section">
        <div class="section-header">
          <span class="section-title">Connection</span>
        </div>
        <div class="settings-group">
          <div class="settings-row" style="flex-direction:column; align-items:flex-start;">
            <div style="display:flex;align-items:center;gap:14px;width:100%">
              <div class="settings-icon" style="background:#0071e3;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
              </div>
              <div class="settings-text">
                <div class="settings-label">n8n Server URL</div>
                <div class="settings-sublabel">Your n8n instance address</div>
              </div>
            </div>
            <input type="url" class="settings-input" id="n8n-url-input" placeholder="http://localhost:5678" value="http://localhost:5678">
          </div>
          <div class="settings-row" style="flex-direction:column; align-items:flex-start;">
            <div style="display:flex;align-items:center;gap:14px;width:100%">
              <div class="settings-icon" style="background:#30d158;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
              </div>
              <div class="settings-text">
                <div class="settings-label">Posts per Page</div>
                <div class="settings-sublabel">How many posts to load</div>
              </div>
            </div>
            <input type="number" class="settings-input" id="posts-per-page" placeholder="20" value="20" min="5" max="50">
          </div>
        </div>
      </div>

      <div class="settings-section" style="animation-delay:0.1s">
        <div class="section-header">
          <span class="section-title">About</span>
        </div>
        <div class="settings-group">
          <div class="settings-row">
            <div class="settings-icon" style="background:#ff9f0a;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
            </div>
            <div class="settings-text">
              <div class="settings-label">PostFlow</div>
              <div class="settings-sublabel">LinkedIn HR Agent Dashboard</div>
            </div>
            <div class="settings-value">v1.0</div>
          </div>
          <div class="settings-row" onclick="testConnection()" style="cursor:pointer;">
            <div class="settings-icon" style="background:#5e5ce6;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            </div>
            <div class="settings-text">
              <div class="settings-label">Test Connection</div>
              <div class="settings-sublabel">Verify n8n is reachable</div>
            </div>
            <div class="chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
          <div class="settings-row" onclick="saveSettings()" style="cursor:pointer;">
            <div class="settings-icon" style="background:#0071e3;">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            </div>
            <div class="settings-text">
              <div class="settings-label">Save Settings</div>
              <div class="settings-sublabel">Apply configuration changes</div>
            </div>
            <div class="chevron"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- Sheet Overlay -->
<div class="sheet-overlay" id="sheet-overlay" onclick="closeSheet()"></div>

<!-- Post Detail Sheet -->
<div class="sheet" id="post-sheet">
  <div class="sheet-handle"></div>
  <div class="sheet-header">
    <div class="sheet-title" id="sheet-title">Review Post</div>
    <button class="sheet-close" onclick="closeSheet()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
    </button>
  </div>
  <div class="sheet-body">
    <div class="sheet-pillar-tag" id="sheet-pillar">—</div>
    <div id="sheet-view-mode">
      <div class="sheet-post-text" id="sheet-content">—</div>
    </div>
    <div id="sheet-edit-mode" style="display:none;">
      <textarea class="edit-textarea" id="edit-textarea" oninput="updateCharCount()"></textarea>
      <div class="char-count" id="char-count">0 characters</div>
    </div>
  </div>
  <div class="sheet-actions" id="sheet-actions">
    <!-- Dynamically populated -->
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<script>
// ── Config ─────────────────────────────────────────────────────
let config = {
  n8nUrl: localStorage.getItem('n8n_url') || 'http://localhost:5678',
  postsPerPage: parseInt(localStorage.getItem('posts_per_page') || '20')
};

let currentPost = null;
let isEditMode = false;
let allPosts = [];

// ── Init ───────────────────────────────────────────────────────
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('n8n-url-input').value = config.n8nUrl;
  document.getElementById('posts-per-page').value = config.postsPerPage;
  loadAllData();
});

// ── Data Loading ───────────────────────────────────────────────
async function loadAllData() {
  await Promise.all([loadQueue(), loadHistory(), loadStats()]);
}

async function loadQueue() {
  const list = document.getElementById('queue-list');
  list.innerHTML = skeletonHTML(3);

  try {
    const res = await fetch(`${config.n8nUrl}/webhook/get-posts?status=pending&limit=${config.postsPerPage}`);
    if (!res.ok) throw new Error('Failed to fetch');
    const posts = await res.json();
    allPosts = posts;
    renderQueue(posts);
  } catch(e) {
    // Fallback: try to get from DB via another endpoint
    list.innerHTML = emptyStateHTML(
      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>`,
      'Could not load posts',
      'Make sure n8n is running and the webhook is active.'
    );
    console.error('Load error:', e);
  }
}

async function loadHistory() {
  const list = document.getElementById('history-list');
  list.innerHTML = skeletonHTML(2);

  try {
    const res = await fetch(`${config.n8nUrl}/webhook/get-posts?status=history&limit=${config.postsPerPage}`);
    if (!res.ok) throw new Error('Failed');
    const posts = await res.json();
    renderHistory(posts);
  } catch(e) {
    list.innerHTML = emptyStateHTML(
      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>`,
      'No history yet',
      'Approved and published posts will appear here.'
    );
  }
}

async function loadStats() {
  try {
    const res = await fetch(`${config.n8nUrl}/webhook/get-posts?status=stats`);
    if (!res.ok) throw new Error('Failed');
    const data = await res.json();
    document.getElementById('stat-pending').textContent = data.pending ?? '0';
    document.getElementById('stat-approved').textContent = data.approved ?? '0';
    document.getElementById('stat-published').textContent = data.published ?? '0';
    document.getElementById('queue-badge').textContent = data.pending ?? '0';
  } catch(e) {
    document.getElementById('stat-pending').textContent = '—';
    document.getElementById('stat-approved').textContent = '—';
    document.getElementById('stat-published').textContent = '—';
  }
}

// ── Render Queue ───────────────────────────────────────────────
function renderQueue(posts) {
  const list = document.getElementById('queue-list');
  document.getElementById('queue-badge').textContent = posts.length;

  if (!posts.length) {
    list.innerHTML = emptyStateHTML(
      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="20 6 9 17 4 12"/></svg>`,
      'All caught up!',
      'No posts waiting for review. New posts are generated daily at 8am and 6pm.'
    );
    return;
  }

  list.innerHTML = posts.map(post => postCardHTML(post)).join('');
}

function postCardHTML(post) {
  const lines = (post.content || '').split('\n').filter(l => l.trim());
  const hook = lines[0] || 'No content';
  const body = lines.slice(1).join(' ') || '';
  const time = formatRelativeTime(post.created_at);
  const words = post.estimated_words || post.content?.split(' ').length || 0;

  return `
    <div class="post-card status-${post.approval_status}" onclick="openPost('${post.id}')">
      <div class="post-card-header">
        <div class="post-pillar-tag">
          <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
          ${escapeHtml(post.topic_pillar || 'General')}
        </div>
        <div class="post-status-dot"></div>
      </div>
      <div class="post-content-preview">
        <div class="post-hook">${escapeHtml(hook)}</div>
        ${body ? `<div class="post-body-preview">${escapeHtml(body)}</div>` : ''}
      </div>
      <div class="post-meta">
        <span class="post-time">${time}</span>
        <span class="post-words">${words}w</span>
      </div>
      <div class="post-actions" onclick="event.stopPropagation()">
        <button class="btn btn-approve" onclick="quickApprove('${post.id}', this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>
          Approve
        </button>
        <button class="btn btn-edit" onclick="openPost('${post.id}')">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
          Edit
        </button>
        <button class="btn btn-reject" onclick="quickReject('${post.id}', this)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          Reject
        </button>
      </div>
    </div>`;
}

// ── Render History ─────────────────────────────────────────────
function renderHistory(posts) {
  const list = document.getElementById('history-list');

  if (!posts.length) {
    list.innerHTML = emptyStateHTML(
      `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>`,
      'No history yet',
      'Approved and published posts will appear here.'
    );
    return;
  }

  list.innerHTML = posts.map(post => {
    const lines = (post.content || '').split('\n').filter(l => l.trim());
    const preview = lines[0] || '';
    const time = formatRelativeTime(post.created_at);
    const statusClass = `badge-${post.post_status || post.approval_status}`;
    const statusLabel = post.post_status === 'published' ? '✓ Published' :
                        post.approval_status === 'rejected' ? '✕ Rejected' : '• Approved';

    return `
      <div class="history-card">
        <div class="history-card-header">
          <div class="post-pillar-tag" style="background:var(--surface-2);color:var(--text-secondary);">
            ${escapeHtml(post.topic_pillar || 'General')}
          </div>
          <span class="history-status-badge ${statusClass}">${statusLabel}</span>
        </div>
        <div class="history-preview">${escapeHtml(preview)}</div>
        <div class="post-meta" style="border-top:1px solid var(--border);padding:10px 16px;">
          <span class="post-time">${time}</span>
        </div>
      </div>`;
  }).join('');
}

// ── Post Sheet ─────────────────────────────────────────────────
function openPost(postId) {
  const post = allPosts.find(p => p.id === postId);
  if (!post) return;

  currentPost = post;
  isEditMode = false;

  const lines = (post.content || '').split('\n').filter(l => l.trim());
  const hook = lines[0] || '';

  document.getElementById('sheet-title').textContent = 'Review Post';
  document.getElementById('sheet-pillar').textContent = post.topic_pillar || 'General';
  document.getElementById('sheet-content').textContent = post.content || '';
  document.getElementById('edit-textarea').value = post.content || '';

  document.getElementById('sheet-view-mode').style.display = 'block';
  document.getElementById('sheet-edit-mode').style.display = 'none';

  renderSheetActions(false);
  openSheet();
}

function renderSheetActions(editMode) {
  const actions = document.getElementById('sheet-actions');
  if (editMode) {
    actions.innerHTML = `
      <button class="btn-full btn-full-save" onclick="saveEdit()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Save & Approve
      </button>
      <button class="btn-full" style="background:var(--surface-2);color:var(--text-secondary);" onclick="cancelEdit()">
        Cancel Edit
      </button>`;
  } else {
    actions.innerHTML = `
      <button class="btn-full btn-full-approve" onclick="approvePost()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
        Approve & Publish
      </button>
      <button class="btn-full" style="background:var(--surface-2);color:var(--text-primary);font-weight:600;" onclick="startEdit()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
        Edit Before Approving
      </button>
      <button class="btn-full btn-full-reject" onclick="rejectPost()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="18" height="18"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
        Reject Post
      </button>`;
  }
}

function startEdit() {
  isEditMode = true;
  document.getElementById('sheet-title').textContent = 'Edit Post';
  document.getElementById('sheet-view-mode').style.display = 'none';
  document.getElementById('sheet-edit-mode').style.display = 'block';
  document.getElementById('edit-textarea').focus();
  updateCharCount();
  renderSheetActions(true);
}

function cancelEdit() {
  isEditMode = false;
  document.getElementById('sheet-title').textContent = 'Review Post';
  document.getElementById('sheet-view-mode').style.display = 'block';
  document.getElementById('sheet-edit-mode').style.display = 'none';
  renderSheetActions(false);
}

function updateCharCount() {
  const text = document.getElementById('edit-textarea').value;
  const count = text.length;
  const el = document.getElementById('char-count');
  el.textContent = `${count} characters · ~${Math.ceil(count/5)} words`;
  el.className = 'char-count' + (count > 3000 ? ' over' : count > 2500 ? ' warn' : '');
}

// ── Quick Actions ──────────────────────────────────────────────
async function quickApprove(postId, btn) {
  const original = btn.innerHTML;
  btn.innerHTML = '<div class="spinner"></div>';
  btn.disabled = true;
  await sendDecision(postId, 'approved', null);
  removePostCard(postId);
}

async function quickReject(postId, btn) {
  const original = btn.innerHTML;
  btn.innerHTML = '<div class="spinner" style="border-color:rgba(255,59,48,0.3);border-top-color:var(--red);"></div>';
  btn.disabled = true;
  await sendDecision(postId, 'rejected', null);
  removePostCard(postId);
}

async function approvePost() {
  if (!currentPost) return;
  const btn = document.querySelector('.btn-full-approve');
  btn.innerHTML = '<div class="spinner"></div> Publishing...';
  btn.disabled = true;
  await sendDecision(currentPost.id, 'approved', null);
  closeSheet();
  removePostCard(currentPost.id);
}

async function saveEdit() {
  if (!currentPost) return;
  const content = document.getElementById('edit-textarea').value.trim();
  if (!content) { showToast('Post content cannot be empty', 'error'); return; }
  const btn = document.querySelector('.btn-full-save');
  btn.innerHTML = '<div class="spinner"></div> Saving...';
  btn.disabled = true;
  await sendDecision(currentPost.id, 'edited', content);
  closeSheet();
  removePostCard(currentPost.id);
}

async function rejectPost() {
  if (!currentPost) return;
  await sendDecision(currentPost.id, 'rejected', null);
  closeSheet();
  removePostCard(currentPost.id);
}

// ── API Call ───────────────────────────────────────────────────
async function sendDecision(postId, decision, content) {
  const payload = { post_id: postId, decision };
  if (content) payload.content = content;

  try {
    const res = await fetch(`${config.n8nUrl}/webhook/post-approval`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await res.json();

    if (data.status === 'ok') {
      const messages = {
        approved: '✓ Post approved and sent to LinkedIn',
        rejected: 'Post rejected — a new one will be generated',
        edited: '✓ Post edited and approved'
      };
      showToast(messages[decision] || 'Done', 'success');
      loadStats();
    } else {
      showToast(data.message || 'Something went wrong', 'error');
    }
  } catch(e) {
    showToast('Connection error — check n8n is running', 'error');
    console.error(e);
  }
}

function removePostCard(postId) {
  allPosts = allPosts.filter(p => p.id !== postId);
  const cards = document.querySelectorAll('.post-card');
  cards.forEach(card => {
    if (card.getAttribute('onclick')?.includes(postId)) {
      card.style.transition = 'all 0.3s ease';
      card.style.opacity = '0';
      card.style.transform = 'scale(0.95) translateY(-8px)';
      card.style.maxHeight = card.offsetHeight + 'px';
      setTimeout(() => {
        card.style.maxHeight = '0';
        card.style.marginBottom = '0';
        card.style.padding = '0';
        setTimeout(() => {
          card.remove();
          if (!allPosts.length) renderQueue([]);
        }, 200);
      }, 250);
    }
  });
}

// ── Sheet ──────────────────────────────────────────────────────
function openSheet() {
  document.getElementById('sheet-overlay').classList.add('open');
  document.getElementById('post-sheet').classList.add('open');
  document.body.style.overflow = 'hidden';
}

function closeSheet() {
  document.getElementById('sheet-overlay').classList.remove('open');
  document.getElementById('post-sheet').classList.remove('open');
  document.body.style.overflow = '';
  currentPost = null;
  isEditMode = false;
}

// ── Tabs ───────────────────────────────────────────────────────
function switchTab(name) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
  document.getElementById(`tab-${name}`).classList.add('active');
  document.getElementById(`panel-${name}`).classList.add('active');
}

// ── Toast ──────────────────────────────────────────────────────
function showToast(message, type = 'success') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  const icon = type === 'success'
    ? `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><polyline points="20 6 9 17 4 12"/></svg>`
    : `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>`;
  toast.innerHTML = `<div class="toast-icon">${icon}</div><span>${message}</span>`;
  container.appendChild(toast);
  setTimeout(() => {
    toast.classList.add('removing');
    setTimeout(() => toast.remove(), 300);
  }, 3500);
}

// ── Settings ───────────────────────────────────────────────────
function saveSettings() {
  config.n8nUrl = document.getElementById('n8n-url-input').value.replace(/\/$/, '');
  config.postsPerPage = parseInt(document.getElementById('posts-per-page').value) || 20;
  localStorage.setItem('n8n_url', config.n8nUrl);
  localStorage.setItem('posts_per_page', config.postsPerPage);
  showToast('Settings saved', 'success');
  loadAllData();
}

async function testConnection() {
  showToast('Testing connection...', 'success');
  try {
    const res = await fetch(`${config.n8nUrl}/healthz`, { signal: AbortSignal.timeout(5000) });
    showToast(res.ok ? '✓ n8n is reachable' : '✗ n8n returned an error', res.ok ? 'success' : 'error');
  } catch(e) {
    showToast('✗ Cannot reach n8n server', 'error');
  }
}

// ── Helpers ────────────────────────────────────────────────────
function escapeHtml(str) {
  return (str || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

function formatRelativeTime(dateStr) {
  if (!dateStr) return 'Just now';
  const diff = Date.now() - new Date(dateStr).getTime();
  const m = Math.floor(diff / 60000);
  const h = Math.floor(m / 60);
  const d = Math.floor(h / 24);
  if (m < 1) return 'Just now';
  if (m < 60) return `${m}m ago`;
  if (h < 24) return `${h}h ago`;
  return `${d}d ago`;
}

function skeletonHTML(count) {
  return Array(count).fill(0).map(() => `
    <div class="skeleton-card">
      <div class="skeleton-line short"></div>
      <div class="skeleton-line tall"></div>
      <div class="skeleton-line medium"></div>
      <div class="skeleton-line short"></div>
    </div>`).join('');
}

function emptyStateHTML(iconSvg, title, subtitle) {
  return `
    <div class="empty-state">
      <div class="empty-icon">${iconSvg}</div>
      <div class="empty-title">${title}</div>
      <div class="empty-subtitle">${subtitle}</div>
    </div>`;
}
</script>
</body>
</html>
